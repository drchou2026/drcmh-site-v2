---
import MobileMenu from './MobileMenu.jsx';
import SearchWidget from './SearchWidget.jsx';
import SearchModal from './SearchModal.jsx'; 

const menuItems = [
  { label: '關於醫師', href: '/#about' },
  { label: '最新消息', href: '/news' },
  { label: '主治專長', href: '/#expertise' },
  { label: '影音專區', href: '/video' },
  { label: '衛教專欄', href: '/blog' },
  { label: '門診資訊', href: '/#clinic' },
];
---

<!-- Pagefind 從Header搬來 再搬回來 -->
<link href="/pagefind/pagefind-ui.css" rel="stylesheet">
<script src="/pagefind/pagefind-ui.js" is:inline async></script>


<header class="sticky top-0 w-full z-[100] bg-white/95 backdrop-blur-md border-b border-white/20 shadow-sm transition-all duration-300" data-pagefind-ignore>
  <div class="container mx-auto px-4 md:px-6 h-20 flex justify-between items-center relative">
    
    {/* 1. Logo 區域 */}
    <a href="/" class="group flex flex-col justify-center items-start shrink-0">
      <span class="font-serif text-2xl font-bold text-primary tracking-wide leading-none group-hover:text-accent transition-colors">
        Dr. Chou
      </span>
      <span class="text-[0.6rem] font-bold text-accent tracking-[0.2em] uppercase mt-1">
        Urology Clinic
      </span>
    </a>

    {/* 2. 桌機版導覽列 + 搜尋 (Desktop Nav) */}
    {/* 使用 lg:flex 隱藏中型平板以下的選單，避免太擠 */}
    <div class="hidden lg:flex items-center gap-6 xl:gap-8 flex-1 justify-end">
      <nav class="flex items-center gap-5 xl:gap-7">
        {menuItems.map(item => (
          <a 
            href={item.href} 
            class="text-sm font-medium text-text hover:text-primary transition-colors relative group py-2 whitespace-nowrap"
          >
            {item.label}
            <span class="absolute bottom-0 left-0 w-0 h-0.5 bg-accent transition-all duration-300 group-hover:w-full"></span>
          </a>
        ))}
      </nav>

      {/* 分隔線 */}
      <div class="h-4 w-px bg-gray-300/50"></div>

      {/* 搜尋 widget (桌機版會直接顯示 input) */}
      <SearchWidget client:idle />

      {/* Instagram 連結 */}
      <a 
        href="#" 
        target="_blank" 
        rel="noopener noreferrer"
        class="text-text/60 hover:text-[#E4405F] transition-colors p-1"
        title="Instagram"
      >
        <i class="fa-brands fa-instagram text-xl"></i>
      </a>

      {/* CTA 按鈕 */}
      <a 
        href="/#clinic" 
        class="px-5 py-2.5 bg-primary text-white text-sm font-bold rounded-full hover:bg-accent hover:-translate-y-0.5 shadow-md shadow-primary/20 transition-all duration-300 shrink-0"
      >
        預約掛號
      </a>
    </div>

    {/* 3. 手機版/平板版 (Mobile/Tablet) */}
    <div class="flex items-center gap-2 lg:hidden">
      {/* 搜尋 widget (手機版會顯示彈窗) */}
      <SearchModal client:load />
      {/* 漢堡選單 */}
      <MobileMenu client:media="(max-width: 1024px)" menuItems={menuItems} />
    </div>

  </div>
</header>

<style is:global>
  /* === Pagefind UI 共用設定 === */
  /* 這裡使用 theme() 函數直接抓取 tailwind.config.mjs 的設定 */
  :root {
    --pagefind-ui-scale: 0.8;
    --pagefind-ui-primary: theme('colors.primary'); /* 自動對應 #2A8BC8 */
    --pagefind-ui-text: theme('colors.text');       /* 自動對應 #334155 */
    --pagefind-ui-background: theme('colors.surface'); /* 自動對應 #FFFFFF */
    --pagefind-ui-border: theme('colors.gray.300');    /* 對應預設 Tailwind Gray */
    --pagefind-ui-border-radius: 9999px;
  }

  /* 隱藏縮圖與清除按鈕 */
  .pagefind-ui__result-thumb,
  .pagefind-ui__search-clear {
    @apply hidden !important;
  }

  /* === 桌機版樣式修正 (#desktop-search) === */
  
  /* 搜尋框本體 */
  #desktop-search .pagefind-ui__search-input {
    @apply bg-gray-50 border border-gray-300 text-sm text-text rounded-full w-full !important;
    /* Tailwind 的 opacity-100 與 visible */
    @apply opacity-100 visible !important; 
    
    height: 40px !important;
    padding-left: 2.5rem !important;
    padding-right: 1rem !important;
  }
  
  /* 搜尋框 Focus 狀態 */
  #desktop-search .pagefind-ui__search-input:focus {
    @apply bg-surface border-primary outline-none !important;
    /* 這裡使用 rgba 手動設定陰影，因為要配合主色透明度 */
    box-shadow: 0 0 0 3px color-mix(in srgb, theme('colors.primary'), transparent 90%) !important;
  }

  /* 搜尋 Icon 位置 */
  #desktop-search .pagefind-ui__search-input::before {
    @apply top-1/2 -translate-y-1/2 !important;
  }

  /* 搜尋結果下拉選單 (Desktop) */
  #desktop-search .pagefind-ui__drawer {
    @apply absolute right-0 w-[320px] bg-surface rounded-xl border border-gray-200 shadow-xl overflow-y-auto !important;
    top: 110%;
    max-height: 400px;
    z-index: 60;
    padding: 0;
  }


  /* === 結果列表通用優化 === */
  .pagefind-ui__result {
    @apply border-b border-gray-100 !important;
    padding: 12px 16px !important;
  }
  
  .pagefind-ui__result:last-child {
    @apply border-none !important;
  }

  .pagefind-ui__result-title {
    @apply font-serif font-bold text-[0.95rem] text-primary !important;
  }
  
  /* 修正連結樣式，去除預設底線 */
  .pagefind-ui__result-link {
    @apply no-underline hover:text-accent transition-colors !important;
  }
  
  .pagefind-ui__message {
    @apply p-4 text-gray-500 text-center !important;
  }
</style>