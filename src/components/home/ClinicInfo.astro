---
import { getEntry } from 'astro:content';
import { MapPin, Phone, Mail, Clock, Calendar, ExternalLink } from 'lucide-react';

// ğŸŸ¢ å¾ Keystatic è®€å–å…¨åŸŸè¨­å®š
const settings = await getEntry('settings', 'global');
const { doctorName, doctorTitle, clinicName, address, phone, email, bookingLink, googleMapEmbedLink } = settings.data;

// ğŸŸ¢ å¾ Keystatic è®€å–é–€è¨ºè¡¨è¨­å®š
const scheduleData = await getEntry('schedule', 'timetable');

const clinicData = {
  name: clinicName || "æ–°åº—é«˜ç¾æ³Œå°¿ç§‘è¨ºæ‰€",
  doctor: "å‘¨å­Ÿç¿°",
  title: doctorTitle || "é™¢é•·",
  address: address || "æ–°åŒ—å¸‚æ–°åº—å€äºŒåå¼µè·¯5è™Ÿ1æ¨“",
  phone: phone || "(è¨ºæ‰€é›»è©±å»ºç½®ä¸­)", 
  email: email || "d10822201@gmail.com",
  mapLink: googleMapEmbedLink || "https://www.google.com/maps/search/?api=1&query=æ–°åŒ—å¸‚æ–°åº—å€äºŒåå¼µè·¯5è™Ÿ1æ¨“",
  bookingLink: bookingLink || "#",
};

// é–€è¨ºè¡¨è¨­å®š
const weeklySchedule = scheduleData?.data?.weeklySchedule || [];

// å‡å¦‚é‚„æ²’æœ‰è¨­å®šï¼Œçµ¦é è¨­å€¼ (ç¢ºä¿ç•«é¢ä¸ç©º)
const defaultSchedule = [
  { day: "é€±ä¸€", morning: { status: "çœ‹è¨º" }, afternoon: { status: "çœ‹è¨º" }, evening: { status: "çœ‹è¨º" } },
  { day: "é€±äºŒ", morning: { status: "ä¼‘è¨º" }, afternoon: { status: "çœ‹è¨º" }, evening: { status: "çœ‹è¨º" } },
  { day: "é€±ä¸‰", morning: { status: "çœ‹è¨º" }, afternoon: { status: "ä¼‘è¨º" }, evening: { status: "çœ‹è¨º" } },
  { day: "é€±å››", morning: { status: "ä¼‘è¨º" }, afternoon: { status: "çœ‹è¨º" }, evening: { status: "çœ‹è¨º" } },
  { day: "é€±äº”", morning: { status: "çœ‹è¨º" }, afternoon: { status: "çœ‹è¨º" }, evening: { status: "ä¼‘è¨º" } },
  { day: "é€±å…­", morning: { status: "çœ‹è¨º" }, afternoon: { status: "ä¼‘è¨º" }, evening: { status: "ä¼‘è¨º" } },
];

const displaySchedule = weeklySchedule.length > 0 ? weeklySchedule : defaultSchedule;

// è¼”åŠ©å‡½å¼ï¼šå–å¾—é¡¯ç¤ºæ–‡å­—
const getStatusLabel = (slot) => {
  if (!slot) return '-';
  if (slot.status === 'è‡ªè¨‚') return slot.customLabel || '-';
  if (slot.status === 'çœ‹è¨º') return 'â—';
  if (slot.status === 'ä¼‘è¨º') return '-';
  if (slot.status === 'ç‰¹ç´„è¨º') return 'ç´„';
  if (slot.status === 'æ‰‹è¡“æ—¥') return 'è¡“';
  return slot.status; // è‹¥æœ‰æœªé æœŸçš„ç‹€æ…‹ï¼Œç›´æ¥é¡¯ç¤º
};

// è¼”åŠ©å‡½å¼ï¼šå–å¾—æ¨£å¼
const getStatusClass = (status) => {
   if (status === 'çœ‹è¨º') return 'text-accent font-bold bg-accent/10';
   if (status === 'ä¼‘è¨º') return 'text-text/20';
   if (status === 'ç‰¹ç´„è¨º') return 'text-orange-500 font-bold bg-orange-100';
   if (status === 'æ‰‹è¡“æ—¥') return 'text-blue-500 font-bold bg-blue-100';
   if (status === 'è‡ªè¨‚') return 'text-primary font-bold bg-gray-100';
   return 'text-text/20';
};
---

<section id="clinic" class="py-24 bg-bg relative overflow-hidden">
  
  {/* èƒŒæ™¯è£é£¾ï¼šå³å´å‚¾æ–œè‰²å¡Š */}
  <div class="absolute top-0 right-0 w-1/3 h-full bg-highlight/30 -skew-x-12 translate-x-20 z-0 pointer-events-none"></div>

  <div class="container mx-auto px-6 relative z-10">
    
    {/* æ¨™é¡Œå€å¡Š */}
    <div class="mb-16 text-center md:text-left">
      <h3 class="text-xs font-bold tracking-[0.2em] uppercase text-accent mb-3">CLINIC INFO</h3>
      <h2 class="text-3xl md:text-4xl font-serif font-bold text-primary">é–€è¨ºè³‡è¨Š</h2>
    </div>

    <div class="flex flex-col lg:flex-row gap-12 lg:gap-20">
      
      {/* å·¦å´ï¼šè¨ºæ‰€è©³æƒ…å¡ç‰‡ */}
      <div class="lg:w-1/2">
        <div class="bg-surface border border-white/50 shadow-2xl rounded-3xl p-8 md:p-12 relative overflow-hidden group">
          
          {/* è£é£¾å…‰æšˆ */}
          <div class="absolute -top-24 -right-24 w-48 h-48 bg-accent/10 rounded-full blur-3xl group-hover:bg-accent/20 transition-colors duration-500"></div>

          {/* æ¨™ç±¤ */}
          <div class="inline-block px-4 py-1.5 bg-primary text-white text-xs font-bold tracking-wider rounded-md mb-8 shadow-md">
            CURRENT LOCATION
          </div>

          {/* è¨ºæ‰€åç¨± */}
          <h3 class="text-3xl font-serif font-bold text-primary mb-2">
            {clinicData.name}
          </h3>
          <p class="text-accent font-medium mb-10 text-lg flex items-center gap-2">
            <span class="w-8 h-0.5 bg-accent inline-block"></span>
            {clinicData.title} | {clinicData.doctor} é†«å¸«
          </p>

          {/* è¯çµ¡è³‡è¨Šåˆ—è¡¨ */}
          <div class="space-y-8">
            
            {/* åœ°å€ */}
            <div class="flex items-start gap-5">
              <div class="w-10 h-10 rounded-full bg-bg flex items-center justify-center text-accent shrink-0 mt-1">
                <MapPin size={20} />
              </div>
              <div>
                <p class="text-xs font-bold text-text/40 uppercase tracking-widest mb-1">Address</p>
                <p class="text-lg text-primary font-medium">{clinicData.address}</p>
                <a 
                  href={clinicData.mapLink} 
                  target="_blank" 
                  rel="noopener noreferrer"
                  class="inline-flex items-center gap-1 text-sm text-accent font-bold mt-2 hover:text-primary transition-colors border-b border-accent/30 pb-0.5 hover:border-primary"
                >
                  åœ¨ Google Maps ä¸ŠæŸ¥çœ‹ <ExternalLink size={14} />
                </a>
              </div>
            </div>
            
            {/* é›»è©± */}
            <div class="flex items-start gap-5">
              <div class="w-10 h-10 rounded-full bg-bg flex items-center justify-center text-accent shrink-0 mt-1">
                <Phone size={20} />
              </div>
              <div>
                <p class="text-xs font-bold text-text/40 uppercase tracking-widest mb-1">Phone</p>
                <p class="text-lg text-primary font-medium">{clinicData.phone}</p>
              </div>
            </div>

            {/* Email */}
            <div class="flex items-start gap-5">
              <div class="w-10 h-10 rounded-full bg-bg flex items-center justify-center text-accent shrink-0 mt-1">
                <Mail size={20} />
              </div>
              <div>
                <p class="text-xs font-bold text-text/40 uppercase tracking-widest mb-1">Email</p>
                <p class="text-lg text-primary font-medium break-all">{clinicData.email}</p>
              </div>
            </div>

          </div>

          {/* CTA æŒ‰éˆ• */}
          <div class="mt-12 pt-8 border-t border-gray-100">
            <a 
              href={clinicData.bookingLink} 
              target="_blank"
              class="block w-full text-center py-4 bg-accent hover:bg-[#B08D55] text-white font-bold rounded-xl transition-all shadow-lg hover:shadow-xl hover:-translate-y-1"
            >
              å‰å¾€ç·šä¸Šæ›è™Ÿ
            </a>
            <p class="text-center text-xs text-text/50 mt-3">
              * å°‡é–‹å•Ÿå¤–éƒ¨æ›è™Ÿç³»çµ±é é¢
            </p>
          </div>

        </div>
      </div>

      {/* å³å´ï¼šé–€è¨ºæ™‚é–“è¡¨ */}
      <div class="lg:w-1/2 flex flex-col justify-center">
        
        <div class="mb-8 flex items-center gap-3">
           <div class="p-3 bg-white rounded-full text-accent shadow-sm">
             <Clock size={24} />
           </div>
           <div>
             <h3 class="text-xl font-bold text-primary">é–€è¨ºæ™‚åˆ»è¡¨</h3>
             <p class="text-sm text-text/60">é€±æ—¥ä¼‘è¨ºï¼Œåœ‹å®šå‡æ—¥è«‹è¦‹å…¬å‘Š</p>
           </div>
        </div>
        
        <div class="bg-surface rounded-3xl p-6 md:p-10 shadow-sm border border-white/50">
           {/* è¡¨é ­ */}
           <div class="grid grid-cols-4 gap-4 mb-6 text-center">
              <div class="text-text/40 font-bold text-sm flex items-center justify-center">
                <Calendar size={16} />
              </div>
              <div class="text-primary font-bold text-sm bg-highlight/50 py-2 rounded-lg">æ—© (0900-1130)</div>
              <div class="text-primary font-bold text-sm bg-highlight/50 py-2 rounded-lg">åˆ (1430-1700)</div>
              <div class="text-primary font-bold text-sm bg-highlight/50 py-2 rounded-lg">æ™š (1800-2100)</div>
           </div>
           
           {/* è¡¨æ ¼å…§å®¹ */}
           <div class="space-y-3">
              {displaySchedule.map((s) => (
                 <div class="grid grid-cols-4 gap-4 items-center text-center group hover:bg-bg/50 rounded-xl transition-colors py-2 px-1">
                    {/* æ˜ŸæœŸ */}
                    <div class="font-bold text-primary text-sm group-hover:text-accent transition-colors">
                      {s.day}
                    </div>
                    
                    {/* æ—©è¨º */}
                    <div class={`text-sm py-2 rounded-lg flex flex-col justify-center items-center transition-all ${getStatusClass(s.morning?.status)}`}>
                       <span>{getStatusLabel(s.morning)}</span>
                       {s.morning?.note && <span class="text-[0.6rem] opacity-70 mt-0.5 font-normal">{s.morning.note}</span>}
                    </div>
                    
                    {/* åˆè¨º */}
                    <div class={`text-sm py-2 rounded-lg flex flex-col justify-center items-center transition-all ${getStatusClass(s.afternoon?.status)}`}>
                       <span>{getStatusLabel(s.afternoon)}</span>
                       {s.afternoon?.note && <span class="text-[0.6rem] opacity-70 mt-0.5 font-normal">{s.afternoon.note}</span>}
                    </div>
                    
                    {/* æ™šè¨º */}
                    <div class={`text-sm py-2 rounded-lg flex flex-col justify-center items-center transition-all ${getStatusClass(s.evening?.status)}`}>
                       <span>{getStatusLabel(s.evening)}</span>
                       {s.evening?.note && <span class="text-[0.6rem] opacity-70 mt-0.5 font-normal">{s.evening.note}</span>}
                    </div>
                 </div>
              ))}
           </div>

           <div class="mt-8 p-4 bg-highlight/30 rounded-xl border border-highlight/50 text-xs text-text/70 leading-relaxed flex gap-3">
              <div class="mt-0.5 min-w-[16px] text-accent">!</div>
              <p>
                å¯¦éš›çœ‹è¨ºæ™‚é–“å¯èƒ½å› æœƒè­°æˆ–æ‰‹è¡“æœ‰æ‰€ç•°å‹•ï¼Œå»ºè­°çœ‹è¨ºå‰å…ˆé€éé›»è©±æˆ–ç·šä¸Šç³»çµ±ç¢ºèªã€‚
              </p>
           </div>
        </div>
      </div>

    </div>
  </div>
</section>